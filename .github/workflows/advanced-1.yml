# ------------DO-NOT-MODIFY-THIS-FILE------------
# This file was automatically generated by github-actions-workflow-ts.
# Instead, modify examples/advanced.wac.ts
# ------------DO-NOT-MODIFY-THIS-FILE------------

name: ExampleAdvanced
'on':
  workflow_dispatch: {}
env:
  SENTRY_APP_NAME: ExampleAdvanced
  SENTRY_ORG: example-org
jobs:
  Test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    strategy:
      matrix:
        node:
          - 12.x
          - 14.x
          - 16.x
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install pnpm
        uses: pnpm/action-setup@v4
        id: pnpm-install
        with:
          version: 9
          run_install: 'false'
      - name: Get pnpm store directory
        id: pnpm-cache
        shell: bash
        run: echo "STORE_PATH=$(pnpm store path)" >> $GITHUB_OUTPUT
      - name: Setup npmrc for Private Packages
        run: |-
          echo "@your-org:registry=https://npm.pkg.github.com" >> .npmrc
          echo "//npm.pkg.github.com/:_authToken=${{ secrets.GITHUB_TOKEN }}" >> .npmrc
      - name: Install Dependencies
        run: pnpm install --frozen-lockfile
      - name: Run Tests
        run: pnpm run test
  Build:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs:
      - Test
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install pnpm
        uses: pnpm/action-setup@v4
        id: pnpm-install
        with:
          version: 9
          run_install: 'false'
      - name: Get pnpm store directory
        id: pnpm-cache
        shell: bash
        run: echo "STORE_PATH=$(pnpm store path)" >> $GITHUB_OUTPUT
      - name: Setup npmrc for Private Packages
        run: |-
          echo "@your-org:registry=https://npm.pkg.github.com" >> .npmrc
          echo "//npm.pkg.github.com/:_authToken=${{ secrets.GITHUB_TOKEN }}" >> .npmrc
      - name: Install Dependencies
        run: pnpm install --frozen-lockfile
      - name: Build
        run: pnpm run build
        env:
          VITE_APP_VERSION: ${{ env.GITHUB_SHA }}
  Deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    environment: ${{ github.event_name == 'release' && 'prod' || 'dev' }}
    permissions:
      contents: read
      id-token: write
    needs:
      - Build
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install pnpm
        uses: pnpm/action-setup@v4
        id: pnpm-install
        with:
          version: 9
          run_install: 'false'
      - name: Get pnpm store directory
        id: pnpm-cache
        shell: bash
        run: echo "STORE_PATH=$(pnpm store path)" >> $GITHUB_OUTPUT
      - name: Setup npmrc for Private Packages
        run: |-
          echo "@your-org:registry=https://npm.pkg.github.com" >> .npmrc
          echo "//npm.pkg.github.com/:_authToken=${{ secrets.GITHUB_TOKEN }}" >> .npmrc
      - name: Install Dependencies
        run: pnpm install --frozen-lockfile
      - name: Deploy
        run: pnpm run deploy
      - name: Multi line yaml with special characters
        run: |-
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
  ReleaseJob:
    uses: your-org/your-repo/.github/workflows/reusable-workflow.yml@main
    secrets: inherit
