---
sidebar_position: 4
---

# Configuration

Customize how github-actions-workflow-ts generates YAML files using a configuration file.

## Config File

Create a config file in your project root. Both TypeScript and JSON formats are supported:

- `wac.config.ts` (recommended) - TypeScript config with type safety
- `wac.config.json` - JSON config

If both files exist, `wac.config.ts` takes precedence.

### TypeScript Config (Recommended)

```typescript
// wac.config.ts
import { defineConfig } from '@github-actions-workflow-ts/cli'

export default defineConfig({
  refs: false,
  headerText: [
    '# ----DO-NOT-MODIFY-THIS-FILE----',
    '# This file was automatically generated by github-actions-workflow-ts.',
    '# Instead, modify `<source-file-path>`',
    '# ----DO-NOT-MODIFY-THIS-FILE----',
  ],
  dumpOptions: {},
  diagnostics: {
    rules: {},
  },
})
```

### JSON Config

```json
{
  "refs": false,
  "headerText": [
    "# ----DO-NOT-MODIFY-THIS-FILE----",
    "# This file was automatically generated by github-actions-workflow-ts.",
    "# Instead, modify `<source-file-path>`",
    "# ----DO-NOT-MODIFY-THIS-FILE----"
  ],
  "dumpOptions": {},
  "diagnostics": {
    "rules": {}
  }
}
```

## Options

### refs

If `true`, convert duplicate objects into YAML references (anchors and aliases).

| Type | Default |
|------|---------|
| `boolean` | `false` |

```json
{
  "refs": true
}
```

### headerText

Customize the header comment in generated YAML files. Use `<source-file-path>` as a placeholder for the source file path.

| Type | Default |
|------|---------|
| `string[]` | See default header |

```json
{
  "headerText": [
    "# Auto-generated from <source-file-path>",
    "# Do not edit directly"
  ]
}
```

### dumpOptions

Options passed to [js-yaml's dump function](https://github.com/nodeca/js-yaml#dump-object---options-). Useful for controlling YAML formatting.

| Type | Default |
|------|---------|
| `object` | `{}` |

```json
{
  "dumpOptions": {
    "lineWidth": 120,
    "noRefs": true
  }
}
```

### outputPaths

Configure custom output directories for generated workflow files. Useful for monorepos where workflows need to be placed in different locations.

| Type | Default |
|------|---------|
| `object` | `undefined` |

```json
{
  "outputPaths": {
    "workflows": {
      "default": ".github/workflows",
      "overrides": [
        {
          "match": "app-a-deploy.wac.ts",
          "path": "packages/app-a/.github/workflows"
        },
        {
          "match": "*-release.wac.ts",
          "path": "packages/releases/.github/workflows"
        },
        {
          "match": "packages/app-b/**/*.wac.ts",
          "path": "packages/app-b/.github/workflows"
        }
      ]
    }
  }
}
```

#### workflows.default

The default output directory for all workflow files. If not specified, defaults to `.github/workflows`.

#### workflows.overrides

An array of override rules. Each rule has:
- `match` - Pattern to match against the source `.wac.ts` file. Supports:
  - Filename patterns: `deploy.wac.ts`, `*-release.wac.ts`
  - Full path patterns: `packages/app-a/**/*.wac.ts`, `src/workflows/*.wac.ts`
- `path` - Output directory for matching workflows

Patterns are matched against both the full relative path and the filename, so `deploy.wac.ts` will match files at any depth.

Overrides are checked in order; the first matching pattern wins.

#### Path Resolution Priority

Output paths are resolved in this order (highest priority first):
1. Workflow-level `outputPath` option (set in the Workflow constructor)
2. Config `outputPaths.workflows.overrides` (first matching pattern)
3. Config `outputPaths.workflows.default`
4. Default `.github/workflows`

All relative paths are resolved from the **project root** (not the current working directory). See [rootDir](#rootdir) for details.

### rootDir

The root directory for resolving output paths. By default, the project root is auto-detected by looking for a `.git` directory or a `package.json` with `workspaces` defined.

| Type | Default |
|------|---------|
| `string` | Auto-detected project root |

This is useful when running `gwf` from a subdirectory but wanting output paths relative to the project root.

```typescript
// wac.config.ts - running from scripts/githubactions/
export default defineConfig({
  rootDir: '../..', // Go up to project root
  outputPaths: {
    workflows: {
      default: '.github/workflows', // Resolves to <project-root>/.github/workflows
    },
  },
})
```

**Example structure:**
```
my-project/                          # Project root (has .git/)
├── .github/workflows/               # Shared workflows go here
├── scripts/
│   └── githubactions/
│       ├── ci.wac.ts
│       ├── deploy.wac.ts
│       ├── wac.config.ts            # Config with rootDir: '../..'
│       └── package.json             # Has "gwf build" script
└── packages/
    └── app-a/
        └── .github/workflows/       # App-specific workflows
```

Without `rootDir`, paths would resolve relative to `scripts/githubactions/`. With `rootDir: '../..'`, paths resolve from `my-project/`.

### diagnostics

Configure diagnostic warnings emitted during build when using `@github-actions-workflow-ts/actions`.

| Type | Default |
|------|---------|
| `object` | `undefined` |

#### Diagnostic Rules

```json
{
  "diagnostics": {
    "rules": {
      "action-version-unverifiable": "off",
      "action-version-semver-violation": {
        "severity": "error",
        "exclude": ["actions/checkout@*"]
      }
    }
  }
}
```

#### Severity Levels

- `"off"` - Suppress the diagnostic entirely
- `"warn"` - Emit as a warning (default)
- `"error"` - Upgrade to an error (fails the build)

#### Exclude Patterns

Suppress diagnostics for specific actions using patterns:

- `"actions/checkout@v3"` - Exact match
- `"actions/checkout@*"` - Any version of actions/checkout
- `"actions/*"` - All actions from the `actions` org

## Example Configuration

A complete example with all options:

### TypeScript

```typescript
// wac.config.ts
import { defineConfig } from '@github-actions-workflow-ts/cli'

export default defineConfig({
  refs: false,
  headerText: [
    '# ============================================',
    '# AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY',
    '# Source: <source-file-path>',
    '# ============================================',
  ],
  dumpOptions: {
    lineWidth: 100,
  },
  outputPaths: {
    workflows: {
      default: '.github/workflows',
      overrides: [
        {
          match: 'app-*-deploy.wac.ts',
          path: 'packages/deployments/.github/workflows',
        },
      ],
    },
  },
  diagnostics: {
    rules: {
      'action-version-unverifiable': 'off',
      'action-version-semver-violation': {
        severity: 'warn',
        exclude: ['actions/checkout@v3', 'docker/*'],
      },
    },
  },
})
```

### JSON

```json
{
  "refs": false,
  "headerText": [
    "# ============================================",
    "# AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY",
    "# Source: <source-file-path>",
    "# ============================================"
  ],
  "dumpOptions": {
    "lineWidth": 100
  },
  "outputPaths": {
    "workflows": {
      "default": ".github/workflows",
      "overrides": [
        {
          "match": "app-*-deploy.wac.ts",
          "path": "packages/deployments/.github/workflows"
        }
      ]
    }
  },
  "diagnostics": {
    "rules": {
      "action-version-unverifiable": "off",
      "action-version-semver-violation": {
        "severity": "warn",
        "exclude": [
          "actions/checkout@v3",
          "docker/*"
        ]
      }
    }
  }
}
```
