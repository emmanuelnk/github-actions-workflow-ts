# @github-actions-workflow-ts/cli

CLI to generate GitHub Actions YAML workflow files from TypeScript.

Stop writing workflows in YAML and use TypeScript instead!

<p align="center"><img src="https://github.com/emmanuelnk/github-actions-workflow-ts/assets/19330930/9121bb33-cd51-41f3-830f-9b4bd1117320" alt="github-actions-workflow-ts-logo" width="400"/></p>

<p align="center">
  <a href="https://github.com/emmanuelnk/github-actions-workflow-ts">
      <img src="https://raw.githubusercontent.com/ellerbrock/open-source-badges/master/badges/open-source-v1/open-source.png" alt="love opensource">
  </a>
  <a href="https://github.com/emmanuelnk/github-actions-workflow-ts/blob/master/LICENSE">
      <img src="https://img.shields.io/badge/license-MIT-green.svg" alt="license">
  </a>
  <a href="https://www.npmjs.com/package/@github-actions-workflow-ts/cli">
      <img src="https://img.shields.io/npm/v/@github-actions-workflow-ts/cli.svg" alt="npm version">
  </a>
</p>

## Installation

Install both the library and CLI:

```bash
npm install --save-dev @github-actions-workflow-ts/lib @github-actions-workflow-ts/cli
```

## Usage

### 1. Write your workflow in TypeScript

Create a `*.wac.ts` file (e.g., `deploy.wac.ts`) anywhere in your project:

```ts
import { Workflow, NormalJob, Step } from '@github-actions-workflow-ts/lib'

const checkoutStep = new Step({
  name: 'Checkout',
  uses: 'actions/checkout@v3',
})

const testJob = new NormalJob('Test', {
  'runs-on': 'ubuntu-latest',
  'timeout-minutes': 2
})

// IMPORTANT: Export the workflow to generate the YAML file
export const exampleWorkflow = new Workflow('example-filename', {
  name: 'Example',
  on: {
    workflow_dispatch: {}
  }
})

testJob.addStep(checkoutStep)
exampleWorkflow.addJob(testJob)
```

### 2. Generate the YAML files

```bash
npx gwf build

# OR

npx generate-workflow-files build
```

This will generate `.github/workflows/example-filename.yml` from your TypeScript workflow definition.

## CLI Commands

| Command | Alias | Description |
|---------|-------|-------------|
| `gwf build` | `generate-workflow-files build`, `gawts build` | Generate YAML workflow files from `*.wac.ts` files |

## Configuration

Create a config file in your project root to customize generation. Both TypeScript (`wac.config.ts`) and JSON (`wac.config.json`) formats are supported. TypeScript config takes precedence if both exist.

### TypeScript Config (Recommended)

```typescript
// wac.config.ts
import type { WacConfig } from '@github-actions-workflow-ts/cli'

const config: WacConfig = {
  refs: false,
  headerText: [
    '# Auto-generated from <source-file-path>',
    '# Do not edit this file directly',
  ],
}

export default config
```

### JSON Config

```json
{
  "refs": false,
  "headerText": [
    "# Auto-generated from <source-file-path>",
    "# Do not edit this file directly"
  ]
}
```

| Property | Description | Default |
|----------|-------------|---------|
| `refs` | Convert duplicate objects into YAML references | `false` |
| `headerText` | Custom header text for generated files. Use `<source-file-path>` as placeholder. | Default header |
| `dumpOptions` | Options for js-yaml dump function | Default options |

## Integration with Husky

For seamless automation, integrate with [husky](https://github.com/typicode/husky):

```bash
npm install --save-dev husky
npx husky-init
```

Add to `package.json`:
```json
{
  "scripts": {
    "build:workflows": "npx gwf build && git add .github/workflows/*.yml"
  }
}
```

Add pre-commit hook:
```bash
npx husky add .husky/pre-commit "npm run build:workflows"
```

## Documentation

For full documentation, examples, and API reference, visit the [main repository](https://github.com/emmanuelnk/github-actions-workflow-ts).

## License

MIT
